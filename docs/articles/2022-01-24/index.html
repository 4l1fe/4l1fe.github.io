<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="utO5yk8RwIXZ-_rnxq_xpMndgtw0MU_VqtE61lNmjsY" />
    <meta name="description" content="An issue, that i can't extend a method __str__, was encountered when i retrieved a list of objects from a third-party service and printed them to see the details, but i got uninformative output. Due to that, i dove into source code to figure out what can i get and came to a point that only tittle, text attributes are printing of those objects and the method can't be extended, as a client library doesn't provide customization and it shouldn't indeed.">    <link rel="icon" type="image/png" href="/files/favicon.png">
    <link rel="alternate" type="application/rss+xml" href="/rss.xml">
    <link href="/files/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/files/css/style.css">
    <script src="/files/js/inconify.min.js"></script>
    <title>Simply patch what is unextendable. </title>
</head>
<body>
<nav class="navbar navbar-light bg-white sticky-top pb-0">
    <div class="container justify-content-center border-bottom border-secondary">
            <a class="navbar-brand fs-3" href="/">Технологоблог<b>Ъ</b></a>
            <span class="mx-2"><a class="github-button mx-2" href="https://github.com/4l1fe/4l1fe.github.io/subscription" data-icon="octicon-eye" data-size="large" 
data-show-count="true" aria-label="Watch 4l1fe/4l1fe.github.io on GitHub">Watch</a></span>
            <span class="mx-2"><a class="github-button mx-2" href="https://github.com/4l1fe/4l1fe.github.io" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star 4l1fe/4l1fe.github.io on GitHub">Star</a></span>
    </div>
</nav>
<div class="container">
        <div class="row">
        <div id="content" class="col-lg-9 order-2 order-lg-1">
            <h1>Simply patch what is unextendable. <a id="simply-patch-what-is-unextendable." href="#simply-patch-what-is-unextendable."><span class="iconify" data-icon="majesticons:hashtag-line"></span></a></h1>
<p><img src="files/main-section.png" alt=""></p>
<p>An issue, that i can't extend a method <code>__str__</code>, was encountered when i retrieved a list of objects from a third-party service and printed them to see the details, but i got uninformative output. Due to that, i dove into source code to figure out what can i get and came to a point that only <code>tittle, text</code> attributes are printing of those objects and the method can't be extended, as a client library doesn't provide customization and it shouldn't indeed.</p>
<p>A rough example of objects retrieving.</p>
<pre><code><span style="color: #f92672">from</span> <span style="color: #f8f8f2">client_library</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">fetch_entities</span>


<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">fecth_print</span><span style="color: #f8f8f2">():</span>
    <span style="color: #f8f8f2">entities</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">fetch_entities()</span>
    <span style="color: #f8f8f2">print(entities)</span>  <span style="color: #75715e">#  Print to see the details and examine the entities.</span>
    
<span style="color: #75715e"># Output is minimalistic:</span>
<span style="color: #75715e"># "Shop, Buy food"</span>
<span style="color: #75715e"># "Gym, Do squats"</span>
</code></pre>
<p>Base class with <code>__str__</code> method the <code>entities</code> are of.</p>
<pre><code><span style="color: #66d9ef">class</span> <span style="color: #a6e22e">Note</span><span style="color: #f8f8f2">(TopLevelNode):</span>
    <span style="color: #e6db74">"""Represents a Google Keep note."""</span>
    <span style="color: #f8f8f2">_TYPE</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">NodeType</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Note</span>
    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">__init__</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">kwargs):</span>
		<span style="color: #f92672">...</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">_get_text_node</span><span style="color: #f8f8f2">(self):</span>
        <span style="color: #f92672">...</span>

    <span style="color: #a6e22e">@property</span>
    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">text</span><span style="color: #f8f8f2">(self):</span>
        <span style="color: #f92672">...</span>

    <span style="color: #a6e22e">@text</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">setter</span>
    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">text</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">value):</span>
        <span style="color: #f92672">...</span>
        
    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">__str__</span><span style="color: #f8f8f2">(self):</span>
        <span style="color: #66d9ef">return</span> <span style="color: #e6db74">'</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">'</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">join([self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">title,</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">text])</span>
</code></pre>
<h2>Solution <a id="solution" href="#solution"><span class="iconify" data-icon="majesticons:hashtag-line"></span></a></h2>
<p>Restriction is clear and what can be done to see more details and which i specifically need. An idea came into my mind, why not to reuse patching technique of a testing practice, <code>unittest.mock</code> is powerful for such a case.</p>
<p>Things to do are simply define a function of a custom printing objects details and patch the <code>__str__</code> method. So easy and tricky, isn't it?</p>
<p>Here we go.</p>
<pre><code><span style="color: #f92672">from</span> <span style="color: #f8f8f2">unittest.mock</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">patch</span>
<span style="color: #f92672">from</span> <span style="color: #f8f8f2">contextlib</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">AbstractContextManager</span>


<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">node_to_str</span><span style="color: #f8f8f2">(self:</span> <span style="color: #f8f8f2">Note):</span>
    <span style="color: #f8f8f2">created</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">timestamps</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">created</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">isoformat(sep</span><span style="color: #f92672">=</span><span style="color: #e6db74">' '</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">timespec</span><span style="color: #f92672">=</span><span style="color: #e6db74">'seconds'</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">updated</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">timestamps</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">updated</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">isoformat(sep</span><span style="color: #f92672">=</span><span style="color: #e6db74">' '</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">timespec</span><span style="color: #f92672">=</span><span style="color: #e6db74">'seconds'</span><span style="color: #f8f8f2">)</span>
    <span style="color: #66d9ef">return</span> <span style="color: #e6db74">f'Node&lt;{</span><span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">type</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">value</span><span style="color: #e6db74">}, "{</span><span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">title</span><span style="color: #e6db74">}", "{</span><span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">text</span><span style="color: #e6db74">}", created="{</span><span style="color: #f8f8f2">created</span><span style="color: #e6db74">}", updated="{</span><span style="color: #f8f8f2">updated</span><span style="color: #e6db74">}"&gt;'</span>


<span style="color: #66d9ef">class</span> <span style="color: #a6e22e">Patch</span><span style="color: #f8f8f2">(AbstractContextManager):</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">__enter__</span><span style="color: #f8f8f2">(self):</span>
        <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">patchers</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[]</span>
        <span style="color: #f8f8f2">node_str_mock</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">patch(</span><span style="color: #e6db74">'gkeepapi.node.Note.__str__'</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">node_to_str)</span>
        <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">patchers</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">append(node_str_mock)</span>

        <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">p</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">patchers:</span>
            <span style="color: #f8f8f2">p</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">start()</span>

        <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">self</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">__exit__</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">exc_type,</span> <span style="color: #f8f8f2">exc_val,</span> <span style="color: #f8f8f2">exc_tb):</span>
        <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">p</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">patchers:</span>
            <span style="color: #f8f8f2">p</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">stop()</span>
</code></pre>
<p>Function <code>node_to_str</code> is the way i'd like to see the object's details and the <code>Patch</code> context-manager class is a wrapper to apply it gracefully.</p>
<p>At a final step running code looks very tidy.</p>
<pre><code><span style="color: #f92672">from</span> <span style="color: #f8f8f2">fetchig</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">fecth_print</span>


<span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">__name__</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">'__main__'</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f92672">from</span> <span style="color: #f8f8f2">patching</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">Patch</span>

    <span style="color: #66d9ef">with</span> <span style="color: #f8f8f2">Patch():</span>
        <span style="color: #f8f8f2">fecth_print()</span>
        
<span style="color: #75715e"># Output looks better now:</span>
<span style="color: #75715e"># "Node&lt;1, Shop, Buy food, created=2022-01-24 17:53:56Z, updated=2022-01-24 17:53:56Z&gt;"</span>
<span style="color: #75715e"># "Node&lt;1, Gym, Do squats, created=2022-01-24 17:53:56Z, updated=2022-01-24 17:53:56Z&gt;"</span>
</code></pre>
<h2>It's a bad approach <a id="it's-a-bad-approach" href="#it's-a-bad-approach"><span class="iconify" data-icon="majesticons:hashtag-line"></span></a></h2>
<p>Goal is reached, code isn't production consequently it's a quite good approach.</p>

        </div>
        <div id="toc" class="col-lg-3 order-1 order-lg-2">
            <ol><li><a href="#solution">Solution</a></li><li><a href="#it's-a-bad-approach">It's a bad approach</a></li></ol>
        </div>
    </div>
    <div class="row">
        <div id="comments" class="col-lg-9">
            <script src="https://utteranc.es/client.js"
                    repo="4l1fe/4l1fe.github.io"
                    issue-term="pathname"
                    label="comment"
                    theme="github-light"
                    crossorigin="anonymous"
                    async>
            </script>
        </div>
    </div>
</div>

<script src="/files/js/github-button.min.js"></script>
</body>
</html>
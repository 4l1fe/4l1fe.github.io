<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="utO5yk8RwIXZ-_rnxq_xpMndgtw0MU_VqtE61lNmjsY" />
    <link rel="icon" type="image/png" href="/files/favicon.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css"
          rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl"
          crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/files/css/style.css">
    <title>ТехнологоблогЪ</title>
</head>
<body>
<nav class="navbar navbar-light bg-white border-bottom border-secondary sticky-top mb-1">
    <div class="container-fluid d-flex justify-content-center ">
            <a class="navbar-brand fs-3" href="/">Технологоблог<b>Ъ</b></a>
            <span class="mx-2"><a class="github-button mx-2" href="https://github.com/4l1fe/4l1fe.github.io/subscription" data-icon="octicon-eye" data-size="large" aria-label="Watch 4l1fe/4l1fe.github.io on GitHub">Watch</a></span>
            <span class="mx-2"><a class="github-button mx-2" href="https://github.com/4l1fe/4l1fe.github.io" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star 4l1fe/4l1fe.github.io on GitHub">Star</a></span>
    </div>
</nav>
<div class="container">
        <div class="row">
        <div id="content" class="col-lg-9 order-2 order-lg-1">
                        <div class="alert alert-secondary" role="alert">
                <h4 class="alert-heading"></p>Страница отображения <i class="bi bi-file-diff"></i>обновлений</h4>
                <p>
                    <ins>Добавлено</ins>
                    <del>Удалено</del>
                </p>
            </div>
                        <h1>Рассмотрение абстракций и их <ins>взаимосвязей библиотек встраиваемых БД</ins><ins><a id="рассмотрение-абстракций-и-их-взаимосвязей-библиотек-встраиваемых-бд"></a></ins><p><ins><img src="files/main-section.png" alt="main-section"></ins></p> </h1> <p> <del>взаимодействия в библиотеках встраиваемых БД.<a id="рассмотрение-абстракций-и-их-взаимодействия-в-библиотеках-встраиваемых-бд."></a>Прежде всего стоит пояснить, что означает встраиваемая БД и чем они вызывают интерес к рассмотрению, чтобы найти для
этого время.
Встраимаевые БД - предоставляющие интерфейс стандартных операций с данными CRUD и поиска по ним, работающие напрямую с файлом на диске, которые встраиваются в процесс выполнения программы, а не выносятся в отдельный.
</del> Часто возникает желание иметь простейшую архитектуру сервиса или программы, в которой будут отсутствовать избыточные компоненты и межсетевое взаимодействие. Это ощутимо сокращает силы и время на <ins>их</ins> реализацию и поддержку. </p><p> <ins>Чтобы придерживаться такого подхода нужно уметь подбирать </ins><ins><strong>подходящие решения</strong>: технологии, библиотеки, программное обеспечение и т.д.</ins><p><ins>Подбор может быть достаточно прямолинейным - формирование списка подходящих решений по их применяемой области , но, очевидно, что такой список окажется слишком большим и перенасыщенным. Сегодня век информации и потому её объём вокруг нас огромен, который человек физически не способен усвоить даже за всю жизнь. Осознание этой проблемы объема естесвенным образом приводит к формированию интеллектуального подхода - применения ряда <strong>аналитических практик</strong>, приводящих к сокращению кол-ва информации, способной быть усвоенной человеком в сроки, соответствующие решаемой задачи, и сохранению уровня её качества, релевантности. Т.е. подход, сокращающий список подходящих решений без погружения в исходной код до приемлимого и, в конечном итоге, одного решения.</ins></p><ins> </ins><p><ins>В данной статье применяется ряд таких практик, на примере подбора библиотек встраиваемых БД. Как таковая решаемая задача отсутствует, потому необходимости придти к выбору одной из них нету.</ins></p><ins> Пару слов о </ins><ins><strong>встраиваемых БД</strong>: при</ins> </p> <del>При</del> реализации эксперементальных программ удобно иметь файл с подходящей структурой <ul><li> <ins>данных для их сохранения и наличия к нему программного интерфейса базовых операций CRUD, поиска, возможно индексации. Приложение к ним практик  прольет на них больше света по выбору оптимального хранения и оперирования данными.</ins><h2><ins>Цели<a id="цели"></a></ins></h2><ins> </ins><li><ins>Сформировать список библиотек встраиваемых БД для рассмотрения.</ins></li><ins> </ins><li><ins>Сформировать список аналитических практик.</ins></li><ins> Определить</ins> <del>данных, полученных из опыта.
Ряд БД базируется на различных алгоритмах.</del><p><del>Так же надо подчеркнуть, что рассматриваются именно структуры и взаимосвязи, без различных замеров производительности. Интерес именно в</del></p><del> </del><h2><del>Ручная допроверка<a id="ручная-допроверка"></a></del></h2><del> </del><p><del>Используя различные ресурсы(платные и бесплатные) добавить информации о библиотеках(интроспекция кода), напр. график динамики внесения изменений(комитов).</del></p><del> </del><h2><del>Цели.<a id="цели."></a></del></h2><del> </del><p><del><strong>Основной идеей таки является выработака практики общего осмотра устройства, структуры библиотек на примере встраиваемых БД на основе sqlite.</strong></del></p><del> </del><p><del>Процесс пути к пониманию заявленной темы рассмотрения не должен быть сложным,</del></p><del> </del><li><del>Сформировать список рассматриваемых БД.</del></li><del> Рассмотреть</del>  вспомогательные инструменты по анализу исходного кода <h2> <ins>библиотек, лежащих в основе практик.</ins><li><ins>Применить каждую практику отдельно по каждой БД из списка, описав преимущества и недостатки.</ins></li><ins> Список БД</ins> <del>библиотек.</del><li><del>Построить диаграммы абстракций.</del></li><del> </del><li><del>Описать преимущества и недостатки по каждой БД.</del></li><del> Список БД для рассмотрения.</del> </h2></li> </ul> <a id="список-бд"></a> <p>В список можно внести огромное кол-во разных вариаций <ins>бибиотек, как упоминалось ранее, но мы сократим</ins> <del>бибиотек: на разных языках, устаревших, в нереализованном состоянии и т.д. Но нужно ограничиться, чтобы сузить</del> его до таковых, которые <del>принесут полезную информацию и</del> могут быть использованы на практике в <ins>будущем(тут конечно каждый сам для себя должен представить, что именно может быть ему полезным, на чем он специализирется или к чему хотел бы приблизиться в своей деятельности). В таких вопросах стоит прислушаться к интуиции.</ins> <del>будущем. А помочь в этом вопросе может личный опыт, знание предметных областей, в которых был он получен, свои идеи, к которым могут быть приложены полученные зания, и, конечно же, интуиция.</del> </p> <p>Помимо прочего, библиотеки должны быть написаны на чистом питоне для чтения исходного кода и техничской возможности анализа вспомогательными инструментами. Основной источник для поиска - </p><p><a href="https://pylint.org/"> <ins>Github.</ins><ul><li><ins><a href="https://dataset.readthedocs.io/en/latest/">dataset Link: https://dataset.readthedocs.io/en/latest/ </a></ins></li><ins> </ins><li><ins><a href="https://tinydb.readthedocs.io/en/latest/">tinydb Link: https://tinydb.readthedocs.io/en/latest/ </a></ins></li><ins> </ins><li><ins><a href="https://github.com/RaRe-Technologies/sqlitedict">sqlitedict Link: https://github.com/RaRe-Technologies/sqlitedict </a></ins></li><ins> </ins><li><ins><a href="https://docs.peewee-orm.com/en/latest/peewee/playhouse.html#kv">peewee-kv Link: https://docs.peewee-orm.com/en/latest/peewee/playhouse.html#kv </a></ins></li><ins> </ins><li><ins><a href="https://docs.peewee-orm.com/en/latest/peewee/playhouse.html#dataset">peewee-dataset Link: https://docs.peewee-orm.com/en/latest/peewee/playhouse.html#dataset </a></ins></li><ins> </ins></ul><ins> </ins><h2><ins>Список практик<a id="список-практик"></a></ins></h2><ins> </ins><p><ins>Приведем их список, применяемых для получения информации по каждой из библиотек, дающей как бы взгляд со стороны на сложность их внутреннего устройства без погружения в исходный код. Перечисление практик идет в порядке от общего к частному, т.е. самая первая описывает общую картину  наименьшим кол-вом деталей и степенью погружения, при этом больше всех затрагивает высокоуровневые асбтракции, на которых бибилотеки базируются:</ins></p><ins> </ins><ul><li><ins>Построение графа зависимостей модулей.</ins></li><ins> </ins><li><ins>Построение диаграммы  классов.</ins></li><ins> </ins><li><ins>Вычисление цикломатической сложности.</ins></li><ins> </ins><li><ins>Построение графа вызовов базового </ins><ins><strong>исполняемого сценария</strong> и упрощенной диаграммы их последовательности. Эта практика более близка к реальному использованию библиотеки, т.к. содержит ряд её вызовов, выполнямых повседневно в реальной работе:
</ins><ul><li><ins>Создание БД.</ins></li><ins> </ins><li><ins>Запись данных.</ins></li><ins> </ins><li><ins>Обновление данных.</ins></li><ins> </ins><li><ins>Получение, поиск данных.</ins></li><ins> </ins></ul><ins> </ins></li><ins> </ins></ul><ins> </ins><p><ins>Далееа вот сопровождающее описание будет частным и самым ценным в проделанной работе.</ins></p><ins> </ins><h2><ins>Вспомогательные инструменты<a id="вспомогательные-инструменты"></a></ins></h2><ins> </ins><p><ins>Перечисление инструментов с общим описанием по каждому, чтобы в дальнейшем было понятно, для чего мы их используем и что от них ожидается.</ins></p><ins> </ins><p><ins>Ресурс, содержащий поддерживаемый <a href="https://github.com/analysis-tools-dev/static-analysis#python">список инструментов Link: https://github.com/analysis-tools-dev/static-analysis#python </a> , по всевозможному анализу кода.</ins></p><ins> </ins><h3><ins>Pyreverse<a id="pyreverse"></a></ins></h3><ins> </ins><ins><a href="https://www.logilab.org/blogentry/6883">https://www.logilab.org/blogentry/6883 Link: https://www.logilab.org/blogentry/6883 </a> https://pylint.org/</ins> <del>Github</del><ul><li><del>4https://dataset.readthedocs.io/en/latest/</del></li><del> </del><li><del>https://tinydb.readthedocs.io/en/latest/</del></li><del> </del><li><del>https://github.com/RaRe-Technologies/sqlitedict</del></li><del> </del><li><del>http://docs.peewee-orm.com/en/latest/peewee/playhouse.html#kv</del></li><del> </del><li><del>http://docs.peewee-orm.com/en/latest/peewee/playhouse.html#dataset</del></li><del> </del><li><del>https://lmdb.readthedocs.io/en/release/</del></li><del> </del><li><del>https://github.com/wbolster/plyvel</del></li><del> </del><li><del>https://github.com/twmht/python-rocksdb <em>based on LevelDB</em></del></li><del> </del><li><del>gdbm</del></li><del> </del><li><del>upscaledb</del></li><del> </del><li><del>http://traildb.io/docs/tutorial/</del></li><del> </del></ul><del> </del><h2><del>Вспомогательные инструменты.<a id="вспомогательные-инструменты."></a></del></h2><del> </del><p><del>Хорошо было бы опереться на результаты работы инструментов по анализу исходного кода, чтобы иметь больше информации для расширения общего взгляда на вещи и работы с предположениями.</del></p><del> </del><p><del>Полученная вспомогательная информация, впрочем, может быть и бесполезной, что выяснится уже при их практическом примененнии.</del></p><del> </del><h3><del>Pyreverse.<a id="pyreverse."></a></del></h3><del> https://www.logilab.org/blogentry/6883
</del> </a></p>  <blockquote><p>Pyreverse analyses Python code and extracts UML class diagrams and package depenndencies.</p> </blockquote> <p> <ins>Утилита является частью пакета <strong>pylint</strong>.</ins> Как видно из цитаты, помогает автоматически построить диаграммы </p><p> <ins>классов. Эти диаграммы дадут нам  видение абстракций, которые содержит БД, и их взаимосвязей. При этом утилита позволяет указывать уровень глубины сканирования исходного кода БД.</ins><h3><ins>Pycallgraph<a id="pycallgraph"></a></ins></h3><ins> </ins><p><ins><a href="https://pycallgraph.readthedocs.io/en/master/">https://pycallgraph.readthedocs.io/en/master/ Link: https://pycallgraph.readthedocs.io/en/master/ </a></ins></p><ins> Утилита строит</ins> <del>классов и импортируемых зависимостей.</del><h3><del>Pycallgraph.<a id="pycallgraph."></a></del></h3><del> </del><p><del>https://pycallgraph.readthedocs.io/en/master/</del></p><del> Понятная альтернатива </del><del><a href="#pyreverse">pyreverse Link: #pyreverse </a>. Строит</del> </p> граф вызовов указанного исполняемого сценария, поэтому необходимо в нем иметь <p><a href="https://github.com/PyCQA/prospector"> <ins>вызовы оптимального кол-ва </ins><ins><strong>базовых абстракций</strong> библиотеки.</ins><h3><ins>Pydeps<a id="pydeps"></a></ins></h3><ins> </ins><p><ins><a href="https://github.com/thebjorn/pydeps">https://github.com/thebjorn/pydeps Link: https://github.com/thebjorn/pydeps </a>.</ins></p><ins> </ins><p><ins>Утилита построения графа зависимостей с генерацией на осное формата <code>.dot</code> программного пакета <a href="http://www.graphviz.org/about/">Graphviz Link: http://www.graphviz.org/about/ </a>. Изображение графа генерируется разными цветами, логика в этом присутствует, но для нас она значения не имеет, поэтому не стоит обращать на это внимание. Графы являются построением наиболее широкой картины того, как БД программно описана, какие верхнеуровневые компоненты содержит и как они взаимосвязаны.</ins></p><ins> </ins><h3><ins>Radon<a id="radon"></a></ins></h3><ins> </ins><p><ins><a href="https://radon.readthedocs.io/en/latest/">https://radon.readthedocs.io/en/latest/ Link: https://radon.readthedocs.io/en/latest/ </a></ins></p><ins> </ins><h3><ins>McCabe<a id="mccabe"></a></ins></h3><ins> </ins><p><ins>https://github.com/PyCQA/mccabe</ins></p><ins> </ins><h3><ins>Prospector<a id="prospector"></a></ins></h3><ins> https://github.com/PyCQA/prospector</ins> <del>вызовы, покрывающие по нисходящей(от высокоуровневых выовов к низкоуровневым) наибольшую часть абстракций библиотеки.</del><h3><del>Sourcegraph.<a id="sourcegraph."></a></del></h3><del> </del><p><del>https://about.sourcegraph.com/</del></p><del> </del><p><del>Не нашел наглядных примеров для понимания, что этот сервис может предоставить.</del></p><del> Prospector.</del> </a></p>  <p>Некий аггрегатор анализирующих инструментов. Может дать информацию сразу по многим аспектом. Теоретически выявляет места, на которые сразу стоит обратить внимание.</p> <p>Полезно использовать при сравнении полученной информации по множеству библиотек в случае подбора более подходящей под решение.</p> <p><a href="https://github.com/klen/pylama"> <h3><ins>Pylama<a id="pylama"></a></ins></h3><ins> https://github.com/klen/pylama</ins> <del>Pylama.</del> </a></p> <p>Альтернатива <a href="#prospector">prospector</a> менее популярная , судя по показателям в Гитхабе.</p> <p><a href="https://github.com/jendrikseipp/vulture"> <h3><ins>Vulture<a id="vulture"></a></ins></h3><ins> https://github.com/jendrikseipp/vulture</ins> <del>Vulture.</del> </a></p> <p>Динамический поисковик неиспользуемого кода. Полезно для видения, насколько исходный код бибилиотеки находится в актуальном состоянии, в каких углах <ins>она запылилась.</ins><h2><ins>Рассмотрение<a id="рассмотрение"></a></ins></h2><ins> </ins><h3><ins>Построение графа зависимостей<a id="построение-графа-зависимостей"></a></ins></h3><ins> </ins><p><ins>На графах не отображаются модули стандартной бибилиотеки, а только лишь внешние зависимости. Сам сканируемый пакет отображается в именованных прямоугольных рамках, очерчивающих его модули, отображаемые окружностями. Внешние зависимости отображаются в виде изображений папок с их именами.</ins></p><ins> </ins><p><ins>Такой граф дает хорошее визуальное представление</ins></p><ins> </ins><h4><ins>Dataset<a id="dataset"></a></ins></h4><ins> </ins><p><ins><code>pydeps --noshow --cluster --keep-target-cluster --rmprefix pydeps. -T png -o deps.png venv/lib/python3.8/site-packages/dataset</code></ins></p><ins> </ins><p><ins><img src="files/dataset/deps.png" alt=""></ins></p><ins> </ins><h4><ins>TinyDB<a id="tinydb"></a></ins></h4><ins> </ins><p><ins><code>pydeps --noshow --cluster --keep-target-cluster --rmprefix tinydb. -T png -o deps.png venv/lib/python3.8/site-packages/tinydb</code></ins></p><ins> </ins><p><ins><img src="files/tinydb/deps.png" alt=""></ins></p><ins> </ins><h4><ins>Sqlitedict<a id="sqlitedict"></a></ins></h4><ins> </ins><p><ins><img src="files/sqlitedict/deps.png" alt=""></ins></p><ins> </ins><p><ins>Как видно эта библиотека не имеет никаких зависимостей и даже не скомпанована как пакет, все абстракции содержатся в одном модуле в 550 строк кода. Всего 2 абстракции и 1 основная.</ins></p><ins> </ins><h4><ins>Peewee-kv, peewe-dataset<a id="peewee-kv,-peewe-dataset"></a></ins></h4><ins> </ins><p><ins>По факту это два модуля пакета <code>playhouse</code> функционал которых реализован на основе библиотеки <strong>peewee</strong>, поэтому они рассматриваются вместе и сканируются единой командой.</ins></p><ins> </ins><p><ins><code>pydeps --include-missing --max-bacon=1 --noshow --cluster --keep-target-cluster --rmprefix playhouse. -T png -o source-deps.png venv/lib/python3.8/site-packages/playhouse</code></ins></p><ins> </ins><p><ins>Команда генерирует взаимосвязи модулей из сканируемого пакета которые нас не интересуют. поэтому следующее изображение отредактировано вручную, а вот <a href="files/peewee-kv/source-deps.png">ссылка на исходное Link: files/peewee-kv/source-deps.png </a> для сравнения.</ins></p><ins> </ins><p><ins><img src="files/peewee-kv/edited-deps.png" alt=""></ins></p><ins> </ins><p><ins>Как видно <code>kv</code> содержит меньше связей по сравнению с <code>dataset</code>.</ins></p><ins> </ins><h3><ins>Построение диаграммы классов<a id="построение-диаграммы-классов"></a></ins></h3><ins> </ins><p><ins>В каждой секции будет присутствовать ссылка на исходную диаграмму - большое по размеру изображение, включающее все что нужно и нет, и изображение ограниченное только базовыми абстракциями библиотеки.</ins></p><ins> </ins><h4><ins>Dataset<a id="dataset"></a></ins></h4><ins> </ins><p><ins><a href="files/dataset/source-classes.png">Полное отображение Link: files/dataset/source-classes.png </a> диаграммы классов для сравнения.</ins></p><ins> </ins><p><ins><code>pyreverse -o png venv/lib/python3.8/site-packages/dataset</code></ins></p><ins> </ins><p><ins><img src="files/dataset/classes.png" alt=""></ins></p><ins> </ins><h4><ins>TinyDB<a id="tinydb"></a></ins></h4><ins> </ins><p><ins><code>pyreverse -o png venv/lib/python3.8/site-packages/tinydb</code></ins></p><ins> </ins><p><ins><img src="files/tinydb/classes.png" alt=""></ins></p><ins> </ins><h4><ins>Sqlitedict<a id="sqlitedict"></a></ins></h4><ins> </ins><p><ins><a href="files/sqlitedict/source-classes.png">Полное отображение Link: files/sqlitedict/source-classes.png </a> диаграммы классов для сравнения.</ins></p><ins> </ins><p><ins><code>pyreverse -o png venv/lib/python3.8/site-packages/sqlitedict.py</code></ins></p><ins> </ins><p><ins><img src="files/sqlitedict/classes.png" alt=""></ins></p><ins> </ins><p><ins>Выглядит минималистично, прямо сейчас открывай код и читай, нет нужды в чтении документации. Напрямую работа в с БД происходит только лишь через <code>SqliteDict</code>, вторая добавляет способность многопоточности и не подразумевает прямых вызовов из исполняемого сценария</ins></p><ins> </ins><h4><ins>Peewee-kv<a id="peewee-kv"></a></ins></h4><ins> </ins><p><ins><a href="files/peewee-kv/source-classes.png">Полное отображение Link: files/peewee-kv/source-classes.png </a> диаграммы классов для сравнения.</ins></p><ins> </ins><p><ins><code>pyreverse -o png venv/lib/python3.8/site-packages/playhouse/kv.py</code></ins></p><ins> </ins><p><ins><img src="files/peewee-kv/classes.png" alt=""></ins></p><ins> </ins><h4><ins>Peewee-dataset<a id="peewee-dataset"></a></ins></h4><ins> </ins><p><ins><a href="files/peewee-dataset/source-classes.png">Полное отображение Link: files/peewee-dataset/source-classes.png </a> диаграммы классов для сравнения.</ins></p><ins> </ins><p><ins><code>pyreverse -o png venv/lib/python3.8/site-packages/playhouse/dataset.p</code></ins></p><ins> </ins><p><ins><img src="files/peewee-dataset/classes.png" alt=""></ins></p> <del>запылилась.</del><h3><del>Поддерживаемый список библиотек по анализу кода.<a id="поддерживаемый-список-библиотек-по-анализу-кода."></a></del></h3><del> </del><p><del>https://github.com/analysis-tools-dev/static-analysis#python</del></p><del> </del><p><del>Может осветить еще потенциальнополезные утилиты или нет. Надо выделить на это отдельное время.</del></p><del> </del><h3><del>Pydeps<a id="pydeps"></a></del></h3><del> </del><p><del>Альтернатива использования  <strong>pyreverse</strong></del></p><del> </del><p><del>https://github.com/thebjorn/pydeps</del></p><del> </del><h3><del>Radon<a id="radon"></a></del></h3><del> </del><p><del>https://radon.readthedocs.io/en/latest/</del></p><del> </del><h2><del>Общая практика рассмотрения.<a id="общая-практика-рассмотрения."></a></del></h2><del> </del><p><del>Список единых операций, выполняемых для получения информации о каждой из библиотек, дающей как бы взгляд со стороны на сложность их внутреннего устройства без погружения в исходный код. Полученные результаты вынесены в отдельную секцию.</del></p><del> </del><li><del>Построение диаграмм взаимосвязей модулей и абстракций.</del></li> </p> <h3>Построение графа вызовов<h3> <ins><a id="построение-графа-вызовов"></a></ins><h3><ins>Цикломатическая и прочие сложности<a id="цикломатическая-и-прочие-сложности"></a></ins></h3><ins> Заключение</ins> </h3> <del>базового сценария и упрощенной диаграммы их последовательности:
</del><ul><li><del>Создание БД.</del></li><del> </del><li><del>Запись данных.</del></li><del> </del><li><del>Обновление данных.</del></li><del> </del><li><del>Получение, поиск данных.</del></li><del> </del></ul><del> </del><h2><del>Рассмотрение.<a id="рассмотрение."></a></del></h2><del> </del><p><del>В общем, приминимо к каждой библиотеке будут выполнены идентичиные шаги анализа, а вот сопровождающее описание будет частным и самым ценным в проделанной работе.</del></p><del> </del><p><del>Шаги:</del></p><del> </del><li><del>prospector</del></li><del> </del><li><del>Граф вызовов pycallgraph к минимальному использованию БД, семантически-общий сниппет кода.</del></li> <a id="заключение"></a></h3> <h3>Dataset 1.4.1<a id="dataset-1.4.1"></a></h3> <p>Надстройка SQLAlchemy, что сразу говорит о многообразии абстракций, состоящих из двух слоёв: <strong>SQLAlchemy ORM, SQLAlchemy Core</strong>.</p> <p>Сама надстройка объявляет 2 основные абстракции: <strong>Database, Table</strong> описанных в 2х модулях суммарно на 1025 строк
кода, имея, тем самым, низкий порог входа понимания их диаграммы взаимодействия.</p> <pre><code>prospector --with-tool vulture
</code></pre> <blockquote><p><a href="files/dataset/prospector.txt">Анализ</a> кода.</p> </blockquote> <pre><code>from pycallgraph import PyCallGraph
from pycallgraph.output import GraphvizOutput

import dataset


with PyCallGraph(output=GraphvizOutput()):
    db = dataset.connect('sqlite:///:memory:')
    table = db['sometable']
    table.insert(dict(name='John Doe', age=37))
    table.insert(dict(name='Jane Doe', age=34, gender='female'))
    john = table.find_one(name='John Doe')
</code></pre> <blockquote><p><a href="files/dataset/pycallgraph.png">Граф</a> вызовов. Содержит очень большой набор вызовов и множества модулей.</p> </blockquote> <pre><code>pyreverse  -AS -f ALL -o png  venv/lib/python3.7/site-packages/dataset
</code></pre> <blockquote><p>Полученная <a href="files/dataset/classes.png">диаграмма классов</a>. Очень громоздкая диаграмма с большим кол-вом классов и взаимосвязей. Сказывается базирование на sqlalchemy.</p> <p><a href="files/dataset/packages.png">Диаграмма связей модулей</a>.</p> </blockquote> <h3>TinyDB 4.3.0<a id="tinydb-4.3.0"></a></h3> <pre><code>prospector --with-tool vulture
</code></pre> <blockquote><p><a href="files/tinydb/prospector.txt">Анализ</a> кода.</p> </blockquote> <pre><code>from pycallgraph import PyCallGraph
from pycallgraph.output import GraphvizOutput

from tinydb import TinyDB, Query
from tinydb.storages import MemoryStorage


with PyCallGraph(output=GraphvizOutput()):
    db = TinyDB(storage=MemoryStorage)
    User = Query()
    db.insert({'name': 'John', 'age': 22})
    db.insert({'name': 'Van', 'car': 'volvo'})
    db.search(User.name == 'Van')
</code></pre> <blockquote><p><a href="files/tinydb/pycallgraph.png">Граф</a> вызовов. Содержит крошечный набор вызовов.</p> </blockquote> <pre><code>pyreverse  -AS -f ALL -o png  venv/lib/python3.7/site-packages/tinydb
</code></pre> <blockquote><p>Полученная <a href="files/tinydb/classes.png">диаграмма классов</a>.</p> <p><a href="files/tinydb/packages.png">Диаграмма связей модулей</a>.</p> </blockquote> <h3>Sqlitedict 1.7.0<a id="sqlitedict-1.7.0"></a></h3> <ul><li><p>Минимализм, выраженный 1м модулем из 550 строк кода.</p> </li> <li><p>Всего <u>2 абстракции и 1 основная</u>, т.е. для взаимодействия с данными используется <strong>SqliteDict</strong>, предоставляющий  соответствующий интерфейс, который обращается к кастомному <strong>SqliteMultithread</strong>. Этот объект уже напрямую выполняет операции в БД.</p> <p><ins><img src="files/sqlitedict/basic-sequence.png" alt="basic-sequence"></ins></p> <pre><del><code class="language-mermaid">sequenceDiagram
participant main
participant SD as calendar:SqliteDict
participant SMT as connection:SqliteMultithread
main-&gt;&gt;+SD: calendar["today"]
SD-&gt;&gt;+SMT: connection.execute(sql)
Note over SMT: select value from calendar where key=today
SMT--&gt;&gt;-SD: "day off"
SD--&gt;&gt;-main: "day off"
</code></del></pre> </li> <li><p>На уровне БД схема таблиц(они же словари) организована наипростейшим образом без возможности кастомизации. <strong>Ключ</strong> объявлен строковым, а <strong>значение</strong> бинарным типами. Таким образом на уровне питона <u>неполностью эмулируются возможности словаря</u>.</p> <pre><code>complex_discount = SqliteDict('db.sqlite')
complex_discount[('pencil', 'case', 'eraser')] = 15

sqlite3.InterfaceError: Error binding parameter 0 - probably unsupported type.
</code></pre> </li> <li><p>Автогенерируемый <strong>индекс</strong> по ключу.</p> </li> <li><p>Поддержка кастомной сериализации значений</p> <pre><code>rss = SqliteDict('db.sqlite', encode=xml_encode, decode=xml_decode)
</code></pre> </li> <li><p>Поддержка многопоточности.</p> <p>Следует отметить, что в данной реализации объект-словарь необходимо разделять между потоками.</p> <pre><code>def job(job_results):
	k, v = fetch()
	job_results[k] = v

job_results = SqliteDict('db.sqlite')

t1 = Thread(target=job, args=(job_results, ))
t2 = Thread(target=job, args=(job_results, ))
</code></pre> </li> <li><p>Зачем-то оставлен режим создания БД в памяти <code>:memory:</code>. Было бы логичным его убрать для позиционируемой персистентности  словаря.</p> </li> <li><p>Хороший кандидат для быстрого старта и фокусировки на логике работы с данными, но остается неясность в том, как будет вести себя объект-словарь при различных вариациях параметров <code>autocommit, journal_mode</code>.</p> </li> </ul> <h2><del>Результаты применения общей практики.<a id="результаты-применения-общей-практики."></a></del></h2><del> </del><h3><del>Dataset.<a id="dataset."></a></del></h3><del> </del><h4><del>Диаграммы.<a id="диаграммы."></a></del></h4><del> </del><p><del><img src="files/dataset/packages.png" alt="packages"></del></p><del> </del><p><del><img src="files/dataset/classes.png" alt="classes"></del></p><del> </del><h3><del>TinyDB.<a id="tinydb."></a></del></h3><del> </del><p><del><img src="files/tinydb/packages.png" alt="packages"></del></p><del> </del><p><del><img src="files/tinydb/classes.png" alt="classes"></del></p><del> </del><h3><del>Sqlitedict<a id="sqlitedict"></a></del></h3><del> </del><p><del><img src="files/sqlitedict/classes.png" alt="classes"></del></p> 
        </div>
        <div id="toc" class="col-lg-3 order-1 order-lg-2">
            <ul><li><a href="#цели">Цели</a></li><li><a href="#список-бд">Список БД</a></li><li><a href="#список-практик">Список практик</a></li><li><a href="#вспомогательные-инструменты">Вспомогательные инструменты</a><ul><li><a href="#pyreverse">Pyreverse</a></li><li><a href="#pycallgraph">Pycallgraph</a></li><li><a href="#pydeps">Pydeps</a></li><li><a href="#radon">Radon</a></li><li><a href="#mccabe">McCabe</a></li><li><a href="#prospector">Prospector</a></li><li><a href="#pylama">Pylama</a></li><li><a href="#vulture">Vulture</a></li></ul></li><li><a href="#рассмотрение">Рассмотрение</a><ul><li><a href="#построение-графа-зависимостей">Построение графа зависимостей</a></li><li><a href="#построение-диаграммы-классов">Построение диаграммы классов</a></li><li><a href="#построение-графа-вызовов">Построение графа вызовов</a></li><li><a href="#цикломатическая-и-прочие-сложности">Цикломатическая и прочие сложности</a></li><li><a href="#заключение">Заключение</a></li><li><a href="#dataset-1.4.1">Dataset 1.4.1</a></li><li><a href="#tinydb-4.3.0">TinyDB 4.3.0</a></li><li><a href="#sqlitedict-1.7.0">Sqlitedict 1.7.0</a></li></ul></li></ul>
        </div>
    </div>
    <div class="row">
        <div id="comments" class="col-lg-9">
            <script src="https://utteranc.es/client.js"
                    repo="4l1fe/4l1fe.github.io"
                    issue-term="pathname"
                    label="comment"
                    theme="github-light"
                    crossorigin="anonymous"
                    async>
            </script>
        </div>
    </div>
</div>

<script src="https://buttons.github.io/buttons.js"></script>
</body>
</html>